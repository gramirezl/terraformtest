name: terraformQA
on:
  workflow_dispatch:
    inputs:
      force_build:
        description: Force Build
        type: boolean
        default: false
        required: false
  push:
    branches:
      - develop
    paths:
      - Infraestructure/Provisioning/QAs/**
jobs:
  build:
    name: Execute Terraform
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Set up Terraform
        run: |
          curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
          echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
          sudo apt-get update && sudo apt-get install terraform

      - name: Terrafrom Script
        working-directory: Infraestructure/Provisioning/QA/
        env:
          TF_API_TOKEN: LOrQVz0Qy2RYdw.atlasv1.BWqetUMBolMsY0Lu1IbzC9g3ObXkhg8MNdzwvl6Kw9FpuGc6Etn7bDq825REeDIWWPI
        run: |
          terraform init
          terraform validate
          terraform plan
##        terraform apply -auto-approve
